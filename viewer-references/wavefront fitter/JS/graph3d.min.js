if(typeof links==="undefined"){links={}}links.Graph3d=function(a,b){this.showZAxis=true;this.rotation=typeof b!=="undefined"?b:true;this.containerElement=a;this.width="400px";this.height="400px";this.margin=10;this.defaultXCenter="55%";this.defaultYCenter="50%";this.style=links.Graph3d.STYLE.DOT;this.showPerspective=true;this.showGrid=true;this.keepAspectRatio=true;this.showShadow=false;this.showGrayBottom=false;this.verticalRatio=0.5;this.animationInterval=1000;this.animationPreload=false;this.animationAutoPlay=false;this.camera=new links.Graph3d.Camera();this.eye=new links.Point3d(0,0,-1);this.dataTable=null;this.dataPoints=null;this.colX=undefined;this.colY=undefined;this.colZ=undefined;this.colValue=undefined;this.colFilter=undefined;this.xMin=0;this.xStep=undefined;this.xMax=1;this.yMin=0;this.yStep=undefined;this.yMax=1;this.zMin=0;this.zStep=undefined;this.zMax=1;this.valueMin=0;this.valueMax=1;this.colorAxis="#4D4D4D";this.colorGrid="#D3D3D3";this.colorDot="#7DC1FF";this.colorDotBorder="#3267D2";this.create()};links.Graph3d.Camera=function(){this.armLocation=new links.Point3d();this.armRotation={};this.armRotation.horizontal=0;this.armRotation.vertical=0;this.armLength=1.7;this.cameraLocation=new links.Point3d();this.cameraRotation=new links.Point3d(Math.PI/2,0,0);this.calculateCameraOrientation()};links.Graph3d.Camera.prototype.setArmLocation=function(a,c,b){this.armLocation.x=a;this.armLocation.y=c;this.armLocation.z=b;this.calculateCameraOrientation()};links.Graph3d.Camera.prototype.setArmRotation=function(a,b){if(a!==undefined){this.armRotation.horizontal=a}if(b!==undefined){this.armRotation.vertical=b;if(this.armRotation.vertical<0){this.armRotation.vertical=0}if(this.armRotation.vertical>0.5*Math.PI){this.armRotation.vertical=0.5*Math.PI}}if(a!==undefined||b!==undefined){this.calculateCameraOrientation()}};links.Graph3d.Camera.prototype.getArmRotation=function(){var a={};a.horizontal=this.armRotation.horizontal;a.vertical=this.armRotation.vertical;return a};links.Graph3d.Camera.prototype.setArmLength=function(a){if(a===undefined){return}this.armLength=a;if(this.armLength<0.71){this.armLength=0.71}if(this.armLength>5){this.armLength=5}this.calculateCameraOrientation()};links.Graph3d.Camera.prototype.getArmLength=function(){return this.armLength};links.Graph3d.Camera.prototype.getCameraLocation=function(){return this.cameraLocation};links.Graph3d.Camera.prototype.getCameraRotation=function(){return this.cameraRotation};links.Graph3d.Camera.prototype.calculateCameraOrientation=function(){this.cameraLocation.x=this.armLocation.x-this.armLength*Math.sin(this.armRotation.horizontal)*Math.cos(this.armRotation.vertical);this.cameraLocation.y=this.armLocation.y-this.armLength*Math.cos(this.armRotation.horizontal)*Math.cos(this.armRotation.vertical);this.cameraLocation.z=this.armLocation.z+this.armLength*Math.sin(this.armRotation.vertical);this.cameraRotation.x=Math.PI/2-this.armRotation.vertical;this.cameraRotation.y=0;this.cameraRotation.z=-this.armRotation.horizontal};links.Graph3d.prototype._setScale=function(){this.scale=new links.Point3d(1/(this.xMax-this.xMin),1/(this.yMax-this.yMin),1/(this.zMax-this.zMin));if(this.keepAspectRatio){if(this.scale.x<this.scale.y){this.scale.y=this.scale.x}else{this.scale.x=this.scale.y}}this.scale.z*=this.verticalRatio;this.scale.value=1/(this.valueMax-this.valueMin);var b=(this.xMax+this.xMin)/2*this.scale.x;var c=(this.yMax+this.yMin)/2*this.scale.y;var a=(this.zMax+this.zMin)/2*this.scale.z;this.camera.setArmLocation(b,c,a)};links.Graph3d.prototype._convert3Dto2D=function(a){var b=this._convertPointToTranslation(a);return this._convertTranslationToScreen(b)};links.Graph3d.prototype._convertPointToTranslation=function(c){var b=c.x*this.scale.x,p=c.y*this.scale.y,l=c.z*this.scale.z,g=this.camera.getCameraLocation().x,f=this.camera.getCameraLocation().y,e=this.camera.getCameraLocation().z,d=Math.sin(this.camera.getCameraRotation().x),o=Math.cos(this.camera.getCameraRotation().x),a=Math.sin(this.camera.getCameraRotation().y),k=Math.cos(this.camera.getCameraRotation().y),n=Math.sin(this.camera.getCameraRotation().z),i=Math.cos(this.camera.getCameraRotation().z),m=k*(n*(p-f)+i*(b-g))-a*(l-e),j=d*(k*(l-e)+a*(n*(p-f)+i*(b-g)))+o*(i*(p-f)-n*(b-g)),h=o*(k*(l-e)+a*(n*(p-f)+i*(b-g)))-d*(i*(p-f)-n*(b-g));return new links.Point3d(m,j,h)};links.Graph3d.prototype._convertTranslationToScreen=function(a){var f=this.eye.x,d=this.eye.y,c=this.eye.z,j=a.x,i=a.y,h=a.z;var g;var e;if(this.showPerspective){g=(j-f)*(c/h);e=(i-d)*(c/h)}else{g=j*-(c/this.camera.getArmLength());e=i*-(c/this.camera.getArmLength())}var b=new links.Point2d(this.xcenter+g*this.frame.canvas.clientWidth,this.ycenter-e*this.frame.canvas.clientWidth);return b};links.Graph3d.prototype.draw=function(c,a){var d=undefined;if(a!==undefined){if(a.width!==undefined){this.width=a.width}if(a.height!==undefined){this.height=a.height}if(a.xCenter!==undefined){this.defaultXCenter=a.xCenter}if(a.yCenter!==undefined){this.defaultYCenter=a.yCenter}if(a.style!==undefined){var b=this._getStyleNumber(a.style);if(b!==-1){this.style=b}}if(a.showGrid!==undefined){this.showGrid=a.showGrid}if(a.showZAxis!==undefined){this.showZAxis=a.showZAxis}if(a.showPerspective!==undefined){this.showPerspective=a.showPerspective}if(a.showShadow!==undefined){this.showShadow=a.showShadow}if(a.showAnimationControls!==undefined){this.showAnimationControls=a.showAnimationControls}if(a.keepAspectRatio!==undefined){this.keepAspectRatio=a.keepAspectRatio}if(a.verticalRatio!==undefined){this.verticalRatio=a.verticalRatio}if(a.animationInterval!==undefined){this.animationInterval=a.animationInterval}if(a.animationPreload!==undefined){this.animationPreload=a.animationPreload}if(a.animationAutoStart!==undefined){this.animationAutoStart=a.animationAutoStart}if(a.xMin!==undefined){this.defaultXMin=a.xMin}if(a.xStep!==undefined){this.defaultXStep=a.xStep}if(a.xMax!==undefined){this.defaultXMax=a.xMax}if(a.yMin!==undefined){this.defaultYMin=a.yMin}if(a.yStep!==undefined){this.defaultYStep=a.yStep}if(a.yMax!==undefined){this.defaultYMax=a.yMax}if(a.zMin!==undefined){this.defaultZMin=a.zMin}if(a.zStep!==undefined){this.defaultZStep=a.zStep}if(a.zMax!==undefined){this.defaultZMax=a.zMax}if(a.valueMin!==undefined){this.defaultValueMin=a.valueMin}if(a.valueMax!==undefined){this.defaultValueMax=a.valueMax}if(a.cameraPosition!==undefined){d=a.cameraPosition}}this._setBackgroundColor(a.backgroundColor);this.setSize(this.width,this.height);if(d!==undefined){this.camera.setArmRotation(d.horizontal,d.vertical);this.camera.setArmLength(d.distance)}else{this.camera.setArmRotation(1,0.5);this.camera.setArmLength(1.7)}this.redraw(c);if(this.animationAutoStart&&this.dataFilter){this.animationStart()}google.visualization.events.trigger(this,"ready",null)};links.Graph3d.prototype._setBackgroundColor=function(a){var c="white";var b="gray";var d=1;if(typeof(a)==="string"){c=a;b="none";d=0}else{if(typeof(a)==="object"){if(a.fill!==undefined){c=a.fill}if(a.stroke!==undefined){b=a.stroke}if(a.strokeWidth!==undefined){d=a.strokeWidth}}else{if(a===undefined){}else{throw"Unsupported type of backgroundColor"}}}this.frame.style.backgroundColor=c;this.frame.style.borderColor=b;this.frame.style.borderWidth=d+"px";this.frame.style.borderStyle="solid"};links.Graph3d.STYLE={DOT:0,DOTLINE:1,DOTCOLOR:2,DOTSIZE:3,LINE:4,GRID:5,SURFACE:6,BOX:7};links.Graph3d.prototype._getStyleNumber=function(a){switch(a){case"dot":return links.Graph3d.STYLE.DOT;case"dot-line":return links.Graph3d.STYLE.DOTLINE;case"dot-color":return links.Graph3d.STYLE.DOTCOLOR;case"dot-size":return links.Graph3d.STYLE.DOTSIZE;case"line":return links.Graph3d.STYLE.LINE;case"grid":return links.Graph3d.STYLE.GRID;case"surface":return links.Graph3d.STYLE.SURFACE;case"box":return links.Graph3d.STYLE.BOX}return -1};links.Graph3d.prototype._getStyleName=function(a){switch(a){case links.Graph3d.STYLE.DOT:return"dot";case links.Graph3d.STYLE.DOTLINE:return"dot-line";case links.Graph3d.STYLE.DOTCOLOR:return"dot-color";case links.Graph3d.STYLE.DOTSIZE:return"dot-size";case links.Graph3d.STYLE.LINE:return"line";case links.Graph3d.STYLE.GRID:return"grid";case links.Graph3d.STYLE.SURFACE:return"surface";case links.Graph3d.STYLE.BOX:return"box"}return""};links.Graph3d.prototype._determineColumnIndexes=function(b,a){if(this.style===links.Graph3d.STYLE.DOT||this.style===links.Graph3d.STYLE.BOX||this.style===links.Graph3d.STYLE.DOTLINE||this.style===links.Graph3d.STYLE.LINE||this.style===links.Graph3d.STYLE.GRID||this.style===links.Graph3d.STYLE.SURFACE){this.colX=0;this.colY=1;this.colZ=2;this.colValue=undefined;if(b.getNumberOfColumns()>3){this.colFilter=3}}else{if(this.style===links.Graph3d.STYLE.DOTCOLOR||this.style===links.Graph3d.STYLE.DOTSIZE){this.colX=0;this.colY=1;this.colZ=2;this.colValue=3;if(b.getNumberOfColumns()>4){this.colFilter=4}}else{throw"Unknown style '"+this.style+"'"}}};links.Graph3d.prototype._dataInitialize=function(d,b){if(d===undefined||d.getNumberOfRows===undefined){return}this._determineColumnIndexes(d,b);this.dataTable=d;this.dataFilter=undefined;if(this.colFilter&&d.getNumberOfColumns()>=this.colFilter){if(this.dataFilter===undefined){this.dataFilter=new links.Filter(d,this.colFilter,this);var c=this;this.dataFilter.setOnLoadCallback(function(){c.redraw()})}}var a=d.getColumnRange(this.colX);this.xMin=(this.defaultXMin!==undefined)?this.defaultXMin:a.min;this.xMax=(this.defaultXMax!==undefined)?this.defaultXMax:a.max;if(this.xMax<=this.xMin){this.xMax=this.xMin+1}this.xStep=(this.defaultXStep!==undefined)?this.defaultXStep:(this.xMax-this.xMin)/5;var g=d.getColumnRange(this.colY);this.yMin=(this.defaultYMin!==undefined)?this.defaultYMin:g.min;this.yMax=(this.defaultYMax!==undefined)?this.defaultYMax:g.max;if(this.yMax<=this.yMin){this.yMax=this.yMin+1}this.yStep=(this.defaultYStep!==undefined)?this.defaultYStep:(this.yMax-this.yMin)/5;var f=d.getColumnRange(this.colZ);this.zMin=(this.defaultZMin!==undefined)?this.defaultZMin:f.min;this.zMax=(this.defaultZMax!==undefined)?this.defaultZMax:f.max;if(this.zMax<=this.zMin){this.zMax=this.zMin+1}this.zStep=(this.defaultZStep!==undefined)?this.defaultZStep:(this.zMax-this.zMin)/5;if(this.colValue!==undefined){var e=d.getColumnRange(this.colValue);this.valueMin=(this.defaultValueMin!==undefined)?this.defaultValueMin:e.min;this.valueMax=(this.defaultValueMax!==undefined)?this.defaultValueMax:e.max;if(this.valueMax<=this.valueMin){this.valueMax=this.valueMin+1}}this._setScale()};links.Graph3d.prototype._getDataPoints=function(r){var b=new Date();var p=[];var q=new Date();if(this.style===links.Graph3d.STYLE.GRID||this.style===links.Graph3d.STYLE.SURFACE){var j=[];var h=[];for(var n=0;n<r.getNumberOfRows();n++){var g=r.getValue(n,this.colX)||0;var f=r.getValue(n,this.colY)||0;if(j.indexOf(g)===-1){j.push(g)}if(h.indexOf(f)===-1){h.push(f)}}function e(t,i){return t-i}j.sort(e);h.sort(e);var o=[];for(var n=0;n<r.getNumberOfRows();n++){var g=r.getValue(n,this.colX)||0;var f=r.getValue(n,this.colY)||0;var d=r.getValue(n,this.colZ)||0;var c=j.indexOf(g);var k=h.indexOf(f);if(o[c]===undefined){o[c]=[]}var s=new links.Point3d();s.x=g;s.y=f;s.z=d;var l={};l.point=s;l.trans=undefined;l.screen=undefined;o[c][k]=l;p.push(l)}for(var g=0;g<o.length;g++){for(var f=0;f<o[g].length;f++){if(o[g][f]){o[g][f].pointRight=(g<o.length-1)?o[g+1][f]:undefined;o[g][f].pointTop=(f<o[g].length-1)?o[g][f+1]:undefined;o[g][f].pointCross=(g<o.length-1&&f<o[g].length-1)?o[g+1][f+1]:undefined}}}}else{for(var n=0;n<r.getNumberOfRows();n++){var m=new links.Point3d();m.x=r.getValue(n,this.colX)||0;m.y=r.getValue(n,this.colY)||0;m.z=r.getValue(n,this.colZ)||0;if(this.colValue!==undefined){m.value=r.getValue(n,this.colValue)||0}var l={};l.point=m;l.trans=undefined;l.screen=undefined;p.push(l)}}for(var n=0;n<p.length;n++){var m=p[n].point;p[n].bottom=new links.Point3d(m.x,m.y,0)}var a=new Date();return p};links.Graph3d.px=function(a){return a+"px"};links.Graph3d.prototype.create=function(){while(this.containerElement.hasChildNodes()){this.containerElement.removeChild(this.containerElement.firstChild)}this.frame=document.createElement("div");this.frame.style.position="relative";this.frame.canvas=document.createElement("canvas");this.frame.canvas.style.position="relative";this.frame.appendChild(this.frame.canvas);var e=document.createElement("DIV");e.style.color="red";e.style.fontWeight="bold";e.style.padding="10px";e.innerHTML="Error: your browser does not support HTML canvas";this.frame.canvas.appendChild(e);this.frame.filter=document.createElement("div");this.frame.filter.style.position="absolute";this.frame.filter.style.bottom="0px";this.frame.filter.style.left="0px";this.frame.filter.style.width="100%";this.frame.appendChild(this.frame.filter);var c=this;var d=function(f){c._onKeyDown(f)};if(c.rotation){var a=function(f){c._onMouseDown(f)};links.addEventListener(this.frame.canvas,"mousedown",a)}var b=function(f){c._onTouchStart(f)};links.addEventListener(this.frame.canvas,"keydown",d);links.addEventListener(this.frame.canvas,"touchstart",b);this.containerElement.appendChild(this.frame)};links.Graph3d.prototype.setSize=function(b,a){this.frame.style.width=b;this.frame.style.height=a;this._resizeCanvas()};links.Graph3d.prototype._resizeCanvas=function(){this.frame.canvas.style.width="100%";this.frame.canvas.style.height="100%";this.frame.canvas.width=this.frame.canvas.clientWidth;this.frame.canvas.height=this.frame.canvas.clientHeight;this.frame.filter.style.width=(this.frame.canvas.clientWidth-2*10)+"px"};links.Graph3d.prototype.animationStart=function(){if(!this.frame.filter||!this.frame.filter.slider){throw"No animation available"}this.frame.filter.slider.play()};links.Graph3d.prototype.animationStop=function(){if(!this.frame.filter||!this.frame.filter.slider){throw"No animation available"}this.frame.filter.slider.stop()};links.Graph3d.prototype._resizeCenter=function(){if(this.defaultXCenter.charAt(this.defaultXCenter.length-1)==="%"){this.xcenter=parseFloat(this.defaultXCenter)/100*this.frame.canvas.clientWidth}else{this.xcenter=parseFloat(this.defaultXCenter)}if(this.defaultYCenter.charAt(this.defaultYCenter.length-1)==="%"){this.ycenter=parseFloat(this.defaultYCenter)/100*(this.frame.canvas.clientHeight-this.frame.filter.clientHeight)}else{this.ycenter=parseFloat(this.defaultYCenter)}};links.Graph3d.prototype.setCameraPosition=function(a){if(a===undefined){return}if(a.horizontal!==undefined&&a.vertical!==undefined){this.camera.setArmRotation(a.horizontal,a.vertical)}if(a.distance!==undefined){this.camera.setArmLength(a.distance)}this.redraw()};links.Graph3d.prototype.getCameraPosition=function(){var a=this.camera.getArmRotation();a.distance=this.camera.getArmLength();return a};links.Graph3d.prototype._readData=function(a){this._dataInitialize(a,this.style);if(this.dataFilter){this.dataPoints=this.dataFilter._getDataPoints()}else{this.dataPoints=this._getDataPoints(this.dataTable)}this._redrawFilter()};links.Graph3d.prototype.redraw=function(b){if(b!==undefined){this._readData(b)}var c=new Date();if(this.dataPoints===undefined){throw"Error: graph data not initialized"}this._resizeCanvas();this._resizeCenter();this._redrawSlider();this._redrawClear();this._redrawAxis();if(this.style===links.Graph3d.STYLE.GRID||this.style===links.Graph3d.STYLE.SURFACE){this._redrawDataGrid()}else{if(this.style===links.Graph3d.STYLE.LINE){this._redrawDataLine()}else{this._redrawDataDot()}}this._redrawInfo();this._redrawLegend();var a=new Date()};links.Graph3d.prototype._redrawClear=function(){var b=this.frame.canvas;var a=b.getContext("2d");a.clearRect(0,0,b.width,b.height)};links.Graph3d.prototype._redrawLegend=function(){if(this.style===links.Graph3d.STYLE.DOTCOLOR||this.style===links.Graph3d.STYLE.DOTSIZE){var a=this.frame.clientWidth*0.02;if(this.style===links.Graph3d.STYLE.DOTSIZE){var j=a/2;var k=a/2+a*2}else{var j=20;var k=20}var m=Math.max(this.frame.clientHeight*0.25,100);var l=this.margin;var t=this.frame.clientWidth-this.margin;var d=t-k;var g=l+m}var b=this.frame.canvas;var n=b.getContext("2d");n.lineWidth=1;n.font="14px arial";if(this.style===links.Graph3d.STYLE.DOTCOLOR){var o=0;var q=m;for(var i=o;i<q;i++){var s=(i-o)/(q-o);var c=s*240;var p=this._hsv2rgb(c,1,1);n.strokeStyle=p;n.beginPath();n.moveTo(d,l+i);n.lineTo(t,l+i);n.stroke()}n.strokeStyle=this.colorAxis;n.strokeRect(d,l,k,m)}if(this.style===links.Graph3d.STYLE.DOTSIZE){n.strokeStyle=this.colorAxis;n.fillStyle=this.colorDot;n.beginPath();n.moveTo(d,l);n.lineTo(t,l);n.lineTo(t-k+j,g);n.lineTo(d,g);n.closePath();n.fill();n.stroke()}if(this.style===links.Graph3d.STYLE.DOTCOLOR||this.style===links.Graph3d.STYLE.DOTSIZE){var r=5;var e=new links.StepNumber(this.valueMin,this.valueMax,(this.valueMax-this.valueMin)/5,true);e.start();if(e.getCurrent()<this.valueMin){e.next()}while(!e.end()){var i=g-(e.getCurrent()-this.valueMin)/(this.valueMax-this.valueMin)*m;n.beginPath();n.moveTo(d-r,i);n.lineTo(d,i);n.stroke();n.textAlign="right";n.textBaseline="middle";n.fillStyle=this.colorAxis;n.fillText(e.getCurrent(),d-2*r,i);e.next()}n.textAlign="right";n.textBaseline="top";var h=this.dataTable.getColumnLabel(this.colValue);n.fillText(h,t,g+this.margin)}};links.Graph3d.prototype._redrawFilter=function(){this.frame.filter.innerHTML="";if(this.dataFilter){var b={visible:this.showAnimationControls};var d=new links.Slider(this.frame.filter,b);this.frame.filter.slider=d;this.frame.filter.style.padding="10px";d.setValues(this.dataFilter.values);d.setPlayInterval(this.animationInterval);var c=this;var a=function(){var e=d.getIndex();c.dataFilter.selectValue(e);c.dataPoints=c.dataFilter._getDataPoints();c.redraw()};d.setOnChangeCallback(a)}else{this.frame.filter.slider=undefined}};links.Graph3d.prototype._redrawSlider=function(){if(this.frame.filter.slider!==undefined){this.frame.filter.slider.redraw()}};links.Graph3d.prototype._redrawInfo=function(){if(this.dataFilter){var c=this.frame.canvas;var b=c.getContext("2d");b.font="14px arial";b.lineStyle="gray";b.fillStyle="gray";b.textAlign="left";b.textBaseline="top";var a=this.margin;var d=this.margin;b.fillText(this.dataFilter.getLabel()+": "+this.dataFilter.getSelectedValue(),a,d)}};links.Graph3d.prototype._redrawAxis=function(){var b=this.frame.canvas;var j=b.getContext("2d");j.font=24/this.camera.getArmLength()+"px arial";var l=0.025/this.scale.x;var i=0.025/this.scale.y;var a=5/this.camera.getArmLength();var k=this.camera.getArmRotation().horizontal;if(this.showZAxis){j.lineWidth=1;var h=(this.defaultZStep===undefined);var c=new links.StepNumber(this.zMin,this.zMax,this.zStep,h);c.start();if(c.getCurrent()<this.zMin){c.next()}var g=(Math.cos(k)>0)?this.xMin:this.xMax;var d=(Math.sin(k)<0)?this.yMin:this.yMax;while(!c.end()){var f=this._convert3Dto2D(new links.Point3d(g,d,c.getCurrent()));j.strokeStyle=this.colorAxis;j.beginPath();j.moveTo(f.x,f.y);j.lineTo(f.x-a,f.y);j.stroke();j.textAlign="right";j.textBaseline="middle";j.fillStyle=this.colorAxis;j.fillText(c.getCurrent()+" ",f.x-5,f.y);c.next()}j.lineWidth=1;var f=this._convert3Dto2D(new links.Point3d(g,d,this.zMin));var e=this._convert3Dto2D(new links.Point3d(g,d,this.zMax));j.strokeStyle=this.colorAxis;j.beginPath();j.moveTo(f.x,f.y);j.lineTo(e.x,e.y);j.stroke()}};links.Graph3d.prototype._hsv2rgb=function(h,f,d){var g,i,b,a,e,c;a=d*f;e=Math.floor(h/60);c=a*(1-Math.abs(((h/60)%2)-1));switch(e){case 0:g=a;i=c;b=0;break;case 1:g=c;i=a;b=0;break;case 2:g=0;i=a;b=c;break;case 3:g=0;i=c;b=a;break;case 4:g=c;i=0;b=a;break;case 5:g=a;i=0;b=c;break;default:g=0;i=0;b=0;break}return"RGB("+parseInt(g*255)+","+parseInt(i*255)+","+parseInt(b*255)+")"};links.Graph3d.prototype._redrawDataGrid=function(){var g=this.frame.canvas;var q=g.getContext("2d");if(this.dataPoints===undefined||this.dataPoints.length<=0){return}for(var t=0;t<this.dataPoints.length;t++){var j=this._convertPointToTranslation(this.dataPoints[t].point);var c=this._convertTranslationToScreen(j);this.dataPoints[t].trans=j;this.dataPoints[t].screen=c;var x=this._convertPointToTranslation(this.dataPoints[t].bottom);this.dataPoints[t].transbottom=x}var z=function(i,h){return i.transbottom.z-h.transbottom.z};this.dataPoints.sort(z);if(this.style===links.Graph3d.STYLE.SURFACE){for(var t=0;t<this.dataPoints.length;t++){var A=this.dataPoints[t];var y=this.dataPoints[t].pointRight;var o=this.dataPoints[t].pointTop;var f=this.dataPoints[t].pointCross;if(A!==undefined&&y!==undefined&&o!==undefined&&f!==undefined){if(this.showGrayBottom||this.showShadow){var p=links.Point3d.subtract(f.trans,A.trans);var k=links.Point3d.subtract(o.trans,y.trans);var e=links.Point3d.crossProduct(p,k);var w=e.length();var b=(e.z>0)}else{var b=true}if(b){var d=(A.point.z+y.point.z+o.point.z+f.point.z)/4;var u=(1-(d-this.zMin)*this.scale.z/this.verticalRatio)*240;var n=1;if(this.showShadow){var m=Math.min(1+(e.x/w)/2,1);var l=this._hsv2rgb(u,n,m);var r=this.colorAxis;var r=l}else{var m=1;var l=this._hsv2rgb(u,n,m);var r=this.colorAxis}}else{var l="gray";var r=this.colorAxis}var a=0.5;q.lineWidth=a;q.fillStyle=l;q.strokeStyle=r;q.beginPath();q.moveTo(A.screen.x,A.screen.y);q.lineTo(y.screen.x,y.screen.y);q.lineTo(f.screen.x,f.screen.y);q.lineTo(o.screen.x,o.screen.y);q.closePath();q.fill();q.stroke()}}}else{for(var t=0;t<this.dataPoints.length;t++){var A=this.dataPoints[t];var y=this.dataPoints[t].pointRight;var o=this.dataPoints[t].pointTop;if(A!==undefined){if(this.showPerspective){var a=2/-A.trans.z}else{var a=2*-(this.eye.z/this.camera.getArmLength())}}if(A!==undefined&&y!==undefined){var d=(A.point.z+y.point.z)/2;var u=(1-(d-this.zMin)*this.scale.z/this.verticalRatio)*240;q.lineWidth=a;q.strokeStyle=this._hsv2rgb(u,1,1);q.beginPath();q.moveTo(A.screen.x,A.screen.y);q.lineTo(y.screen.x,y.screen.y);q.stroke()}if(A!==undefined&&o!==undefined){var d=(A.point.z+o.point.z)/2;var u=(1-(d-this.zMin)*this.scale.z/this.verticalRatio)*240;q.lineWidth=a;q.strokeStyle=this._hsv2rgb(u,1,1);q.beginPath();q.moveTo(A.screen.x,A.screen.y);q.lineTo(o.screen.x,o.screen.y);q.stroke()}}}};links.Graph3d.prototype._redrawDataDot=function(){var a=this.frame.canvas;var m=a.getContext("2d");if(this.dataPoints===undefined||this.dataPoints.length<=0){return}for(var e=0;e<this.dataPoints.length;e++){var o=this._convertPointToTranslation(this.dataPoints[e].point);var l=this._convertTranslationToScreen(o);this.dataPoints[e].trans=o;this.dataPoints[e].screen=l}var d=function(p,i){return p.trans.z-i.trans.z};this.dataPoints.sort(d);var f=this.frame.clientWidth*0.02;for(var e=0;e<this.dataPoints.length;e++){var k=this.dataPoints[e];if(this.style===links.Graph3d.STYLE.DOTLINE){var j=this._convert3Dto2D(new links.Point3d(k.point.x,k.point.y,this.zMin));m.lineWidth=1;m.strokeStyle=this.colorGrid;m.beginPath();m.moveTo(j.x,j.y);m.lineTo(k.screen.x,k.screen.y);m.stroke()}var n;if(this.style===links.Graph3d.STYLE.DOTSIZE){n=f/2+2*f*(k.point.value-this.valueMin)/(this.valueMax-this.valueMin)}else{n=f}var h;if(this.showPerspective){h=n/-k.trans.z}else{h=n*-(this.eye.z/this.camera.getArmLength())}if(h<0){h=0}if(this.style===links.Graph3d.STYLE.DOTCOLOR){var g=(1-(k.point.value-this.valueMin)*this.scale.value)*240;var c=this._hsv2rgb(g,1,1);var b=this._hsv2rgb(g,1,0.8)}else{if(this.style===links.Graph3d.STYLE.DOTSIZE){var c=this.colorDot;var b=this.colorDotBorder}else{var g=(1-(k.point.z-this.zMin)*this.scale.z/this.verticalRatio)*240;var c=this._hsv2rgb(g,1,1);var b=this._hsv2rgb(g,1,0.8)}}bszx=this.frame.clientWidth/(this.xMax+1)/this.camera.getArmLength();bszy=this.frame.clientHeight/(this.yMax+1)/this.camera.getArmLength();m.fillStyle=c;m.beginPath();if(this.style===links.Graph3d.STYLE.BOX){m.rect(k.screen.x,k.screen.y,bszx,bszy)}else{m.arc(k.screen.x,k.screen.y,bszx/2,0,Math.PI*2,true)}m.fill()}};links.Graph3d.prototype._redrawDataLine=function(){var d=this.frame.canvas;var b=d.getContext("2d");if(this.dataPoints===undefined||this.dataPoints.length<=0){return}for(var f=0;f<this.dataPoints.length;f++){var e=this._convertPointToTranslation(this.dataPoints[f].point);var c=this._convertTranslationToScreen(e);this.dataPoints[f].trans=e;this.dataPoints[f].screen=c}if(this.dataPoints.length>0){var a=this.dataPoints[0];b.lineWidth=1;b.strokeStyle="blue";b.beginPath();b.moveTo(a.screen.x,a.screen.y)}for(var f=1;f<this.dataPoints.length;f++){var a=this.dataPoints[f];b.lineTo(a.screen.x,a.screen.y)}if(this.dataPoints.length>0){b.stroke()}};links.Graph3d.prototype._onMouseDown=function(b){b=b||window.event;if(this.leftButtonDown){this._onMouseUp(b)}this.leftButtonDown=b.which?(b.which===1):(b.button===1);if(!this.leftButtonDown&&!this.touchDown){return}this.startMouseX=b.clientX||b.targetTouches[0].clientX;this.startMouseY=b.clientY||b.targetTouches[0].clientY;this.startStart=new Date(this.start);this.startEnd=new Date(this.end);this.startArmRotation=this.camera.getArmRotation();this.frame.style.cursor="move";var a=this;this.onmousemove=function(c){a._onMouseMove(c)};this.onmouseup=function(c){a._onMouseUp(c)};links.addEventListener(document,"mousemove",a.onmousemove);links.addEventListener(document,"mouseup",a.onmouseup);links.preventDefault(b)};links.Graph3d.prototype._onMouseMove=function(g){g=g||window.event;var c=parseFloat(g.clientX||g.targetTouches[0].clientX)-this.startMouseX;var a=parseFloat(g.clientY||g.targetTouches[0].clientY)-this.startMouseY;var e=this.startArmRotation.horizontal+c/200;var h=this.startArmRotation.vertical+a/200;var d=4;var b=Math.sin(d/360*2*Math.PI);if(Math.abs(Math.sin(e))<b){e=Math.round((e/Math.PI))*Math.PI-0.001}if(Math.abs(Math.cos(e))<b){e=(Math.round((e/Math.PI-0.5))+0.5)*Math.PI-0.001}if(Math.abs(Math.sin(h))<b){h=Math.round((h/Math.PI))*Math.PI}if(Math.abs(Math.cos(h))<b){h=(Math.round((h/Math.PI-0.5))+0.5)*Math.PI}this.camera.setArmRotation(e,h);this.redraw();var f=this.getCameraPosition();google.visualization.events.trigger(this,"camerapositionchange",f);links.preventDefault(g)};links.Graph3d.prototype._onMouseUp=function(a){this.frame.style.cursor="auto";this.leftButtonDown=false;links.removeEventListener(document,"mousemove",this.onmousemove);links.removeEventListener(document,"mouseup",this.onmouseup);links.preventDefault(a)};links.Graph3d.prototype._onTouchStart=function(b){this.touchDown=true;var a=this;this.ontouchmove=function(c){a._onTouchMove(c)};this.ontouchend=function(c){a._onTouchEnd(c)};links.addEventListener(document,"touchmove",a.ontouchmove);links.addEventListener(document,"touchend",a.ontouchend);this._onMouseDown(b)};links.Graph3d.prototype._onTouchMove=function(a){this._onMouseMove(a)};links.Graph3d.prototype._onTouchEnd=function(a){this.touchDown=false;links.removeEventListener(document,"touchmove",this.ontouchmove);links.removeEventListener(document,"touchend",this.ontouchend);this._onMouseUp(a)};links.Graph3d.prototype._onWheel=function(c){if(!c){c=window.event}var e=0;if(c.wheelDelta){e=c.wheelDelta/120}else{if(c.detail){e=-c.detail/3}}if(e){var a=this.camera.getArmLength();var d=a*(1-e/10);this.camera.setArmLength(d);this.redraw()}var b=this.getCameraPosition();google.visualization.events.trigger(this,"camerapositionchange",b);links.preventDefault(c)};links.Point3d=function(a,c,b){this.x=a!==undefined?a:0;this.y=c!==undefined?c:0;this.z=b!==undefined?b:0};links.Point3d.subtract=function(d,c){var e=new links.Point3d();e.x=d.x-c.x;e.y=d.y-c.y;e.z=d.z-c.z;return e};links.Point3d.add=function(d,c){var e=new links.Point3d();e.x=d.x+c.x;e.y=d.y+c.y;e.z=d.z+c.z;return e};links.Point3d.crossProduct=function(d,c){var e=new links.Point3d();e.x=d.y*c.z-d.z*c.y;e.y=d.z*c.x-d.x*c.z;e.z=d.x*c.y-d.y*c.x;return e};links.Point3d.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};links.Point2d=function(a,b){this.x=a!==undefined?a:0;this.y=b!==undefined?b:0};links.Filter=function(c,a,b){this.data=c;this.column=a;this.graph=b;this.index=undefined;this.value=undefined;this.values=c.getDistinctValues(this.column);if(this.values.length){this.selectValue(0)}this.dataPoints=[];this.loaded=false;this.onLoadCallback=undefined;if(b.animationPreload){this.loaded=false;this.loadInBackground()}else{this.loaded=true}};links.Filter.prototype.isLoaded=function(){return this.loaded};links.Filter.prototype.getLoadedProgress=function(){var a=this.values.length;var b=0;while(this.dataPoints[b]){b++}return Math.round(b/a*100)};links.Filter.prototype.getLabel=function(){return this.data.getColumnLabel(this.column)};links.Filter.prototype.getColumn=function(){return this.column};links.Filter.prototype.getSelectedValue=function(){if(this.index===undefined){return undefined}return this.values[this.index]};links.Filter.prototype.getValues=function(){return this.values};links.Filter.prototype.getValue=function(a){if(a>=this.values.length){throw"Error: index out of range"}return this.values[a]};links.Filter.prototype._getDataPoints=function(a){if(a===undefined){a=this.index}if(a===undefined){return[]}var d;if(this.dataPoints[a]){d=this.dataPoints[a]}else{var e=new google.visualization.DataView(this.data);var c={};c.column=this.column;c.value=this.values[a];var b=this.data.getFilteredRows([c]);e.setRows(b);d=this.graph._getDataPoints(e);this.dataPoints[a]=d}return d};links.Filter.prototype.setOnLoadCallback=function(a){this.onLoadCallback=a};links.Filter.prototype.selectValue=function(a){if(a>=this.values.length){throw"Error: index out of range"}this.index=a;this.value=this.values[a]};links.Filter.prototype.loadInBackground=function(b){if(b===undefined){b=0}var e=this.graph.frame;if(b<this.values.length){var d=this._getDataPoints(b);if(e.progress===undefined){e.progress=document.createElement("DIV");e.progress.style.position="absolute";e.progress.style.color="gray";e.appendChild(e.progress)}var a=this.getLoadedProgress();e.progress.innerHTML="Loading animation... "+a+"%";e.progress.style.bottom=links.Graph3d.px(60);e.progress.style.left=links.Graph3d.px(10);var c=this;setTimeout(function(){c.loadInBackground(b+1)},10);this.loaded=false}else{this.loaded=true;if(e.progress!==undefined){e.removeChild(e.progress);e.progress=undefined}if(this.onLoadCallback){this.onLoadCallback()}}};links.StepNumber=function(d,a,c,b){this.start_=0;this.end_=0;this.step_=1;this.prettyStep=true;this.precision=5;this.current_=0;this.setRange(d,a,c,b)};links.StepNumber.prototype.setRange=function(d,a,c,b){this.start_=d?d:0;this.end_=a?a:0;this.setStep(c,b)};links.StepNumber.prototype.setStep=function(b,a){if(b===undefined||b<=0){return}if(a!==undefined){this.prettyStep=a}if(this.prettyStep===true){this.step_=links.StepNumber.calculatePrettyStep(b)}else{this.step_=b}};links.StepNumber.calculatePrettyStep=function(d){var e=function(g){return Math.log(g)/Math.LN10};var b=1*Math.pow(10,Math.round(e(d/1))),a=2*Math.pow(10,Math.round(e(d/2))),f=5*Math.pow(10,Math.round(e(d/5)));var c=b;if(Math.abs(a-d)<=Math.abs(c-d)){c=a}if(Math.abs(f-d)<=Math.abs(c-d)){c=f}if(c<=0){c=1}return c};links.StepNumber.prototype.getCurrent=function(){var a=(this.current_).toPrecision(this.precision);if(this.current_<100000){a*=1}return a};links.StepNumber.prototype.getStep=function(){return this.step_};links.StepNumber.prototype.start=function(){this.current_=this.start_-this.start_%this.step_};links.StepNumber.prototype.next=function(){this.current_+=this.step_};links.StepNumber.prototype.end=function(){return(this.current_>this.end_)};links.Slider=function(a,b){if(a===undefined){throw"Error: No container element defined"}this.container=a;this.visible=(b&&b.visible!=undefined)?b.visible:true;if(this.visible){this.frame=document.createElement("DIV");this.frame.style.width="100%";this.frame.style.position="relative";this.container.appendChild(this.frame);this.frame.prev=document.createElement("INPUT");this.frame.prev.type="BUTTON";this.frame.prev.value="Prev";this.frame.appendChild(this.frame.prev);this.frame.play=document.createElement("INPUT");this.frame.play.type="BUTTON";this.frame.play.value="Play";this.frame.appendChild(this.frame.play);this.frame.next=document.createElement("INPUT");this.frame.next.type="BUTTON";this.frame.next.value="Next";this.frame.appendChild(this.frame.next);this.frame.bar=document.createElement("INPUT");this.frame.bar.type="BUTTON";this.frame.bar.style.position="absolute";this.frame.bar.style.border="1px solid red";this.frame.bar.style.width="100px";this.frame.bar.style.height="6px";this.frame.bar.style.borderRadius="2px";this.frame.bar.style.MozBorderRadius="2px";this.frame.bar.style.border="1px solid #7F7F7F";this.frame.bar.style.backgroundColor="#E5E5E5";this.frame.appendChild(this.frame.bar);this.frame.slide=document.createElement("INPUT");this.frame.slide.type="BUTTON";this.frame.slide.style.margin="0px";this.frame.slide.value=" ";this.frame.slide.style.position="relative";this.frame.slide.style.left="-100px";this.frame.appendChild(this.frame.slide);var c=this;this.frame.slide.onmousedown=function(d){c._onMouseDown(d)};this.frame.prev.onclick=function(d){c.prev(d)};this.frame.play.onclick=function(d){c.togglePlay(d)};this.frame.next.onclick=function(d){c.next(d)}}this.onChangeCallback=undefined;this.values=[];this.index=undefined;this.playTimeout=undefined;this.playInterval=1000;this.playLoop=true};links.Slider.prototype.prev=function(){var a=this.getIndex();if(a>0){a--;this.setIndex(a)}};links.Slider.prototype.next=function(){var a=this.getIndex();if(a<this.values.length-1){a++;this.setIndex(a)}};links.Slider.prototype.playNext=function(){var f=new Date();var c=this.getIndex();if(c<this.values.length-1){c++;this.setIndex(c)}else{if(this.playLoop){c=0;this.setIndex(c)}}var a=new Date();var e=(a-f);var b=Math.max(this.playInterval-e,0);var d=this;this.playTimeout=setTimeout(function(){d.playNext()},b)};links.Slider.prototype.togglePlay=function(){if(this.playTimeout===undefined){this.play()}else{this.stop()}};links.Slider.prototype.play=function(){this.playNext();if(this.frame){this.frame.play.value="Stop"}};links.Slider.prototype.stop=function(){clearInterval(this.playTimeout);this.playTimeout=undefined;if(this.frame){this.frame.play.value="Play"}};links.Slider.prototype.setOnChangeCallback=function(a){this.onChangeCallback=a};links.Slider.prototype.setPlayInterval=function(a){this.playInterval=a};links.Slider.prototype.getPlayInterval=function(a){return this.playInterval};links.Slider.prototype.setPlayLoop=function(a){this.playLoop=a};links.Slider.prototype.onChange=function(){if(this.onChangeCallback!==undefined){this.onChangeCallback()}};links.Slider.prototype.redraw=function(){if(this.frame){this.frame.bar.style.top=(this.frame.clientHeight/2-this.frame.bar.offsetHeight/2)+"px";this.frame.bar.style.width=(this.frame.clientWidth-this.frame.prev.clientWidth-this.frame.play.clientWidth-this.frame.next.clientWidth-30)+"px";var a=this.indexToLeft(this.index);this.frame.slide.style.left=(a)+"px"}};links.Slider.prototype.setValues=function(a){this.values=a;if(this.values.length>0){this.setIndex(0)}else{this.index=undefined}};links.Slider.prototype.setIndex=function(a){if(a<this.values.length){this.index=a;this.redraw();this.onChange()}else{throw"Error: index out of range"}};links.Slider.prototype.getIndex=function(){return this.index};links.Slider.prototype.get=function(){return this.values[this.index]};links.Slider.prototype._onMouseDown=function(c){var b=c.which?(c.which===1):(c.button===1);if(!b){return}this.startClientX=c.clientX;this.startSlideX=parseFloat(this.frame.slide.style.left);this.frame.style.cursor="move";var a=this;this.onmousemove=function(d){a._onMouseMove(d)};this.onmouseup=function(d){a._onMouseUp(d)};links.addEventListener(document,"mousemove",this.onmousemove);links.addEventListener(document,"mouseup",this.onmouseup);links.preventDefault(c)};links.Slider.prototype.leftToIndex=function(d){var c=parseFloat(this.frame.bar.style.width)-this.frame.slide.clientWidth-10;var a=d-3;var b=Math.round(a/c*(this.values.length-1));if(b<0){b=0}if(b>this.values.length-1){b=this.values.length-1}return b};links.Slider.prototype.indexToLeft=function(b){var c=parseFloat(this.frame.bar.style.width)-this.frame.slide.clientWidth-10;var a=b/(this.values.length-1)*c;var d=a+3;return d};links.Slider.prototype._onMouseMove=function(c){var d=c.clientX-this.startClientX;var a=this.startSlideX+d;var b=this.leftToIndex(a);this.setIndex(b);links.preventDefault()};links.Slider.prototype._onMouseUp=function(a){this.frame.style.cursor="auto";links.removeEventListener(document,"mousemove",this.onmousemove);links.removeEventListener(document,"mouseup",this.onmouseup);links.preventDefault()};links.addEventListener=function(b,d,c,a){if(b.addEventListener){if(a===undefined){a=false}if(d==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0){d="DOMMouseScroll"}b.addEventListener(d,c,a)}else{b.attachEvent("on"+d,c)}};links.removeEventListener=function(b,d,c,a){if(b.removeEventListener){if(a===undefined){a=false}if(d==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0){d="DOMMouseScroll"}b.removeEventListener(d,c,a)}else{b.detachEvent("on"+d,c)}};links.stopPropagation=function(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}};links.preventDefault=function(a){if(!a){a=window.event}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};links.getAbsoluteLeft=function(a){var b=0;while(a!==null){b+=a.offsetLeft;b-=a.scrollLeft;a=a.offsetParent}return b};links.getAbsoluteTop=function(a){var b=0;while(a!==null){b+=a.offsetTop;b-=a.scrollTop;a=a.offsetParent}return b};